<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡åŒå¼•æ“ä»ªè¡¨æ¿ v3.3 (499 å¤§æˆ·é›·è¾¾)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Microsoft JhengHei', sans-serif; }
        .card { background-color: #1e293b; border: 1px solid #334155; border-radius: 0.75rem; }
        .input-field { background-color: #0f172a; border: 1px solid #475569; color: white; }
        .btn-primary { background-color: #06b6d4; color: white; transition: all 0.2s; }
        .btn-primary:hover { background-color: #0891b2; }
        .text-profit { color: #ef4444; } 
        .text-loss { color: #22c55e; }
        .buy-point { color: #facc15; font-weight: bold; }
        /* 499 å¤§å•ç‰¹æ•ˆ */
        .big-order-row { animation: flash 2s infinite; }
        @keyframes flash {
            0% { background-color: rgba(239, 68, 68, 0.1); }
            50% { background-color: rgba(239, 68, 68, 0.3); }
            100% { background-color: rgba(239, 68, 68, 0.1); }
        }
        /* è‡ªè®¢å·è½´ */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-cyan-400">ğŸš€ å°è‚¡åŒå¼•æ“ä»ªè¡¨æ¿</h1>
            <p class="text-slate-400 text-sm mt-1">Fugle (å³æ—¶) + FinMind (å†å²) | 499 å¤§æˆ·é›·è¾¾ç‰ˆ</p>
        </div>
        <div class="text-right">
            <div id="updateTime" class="text-xs text-slate-500">ç›‘æ§ä¸­...</div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- å·¦ä¾§ï¼šä¸ªè‚¡è¯Šæ–­ -->
        <div class="lg:col-span-1 space-y-6">
            <div class="card p-5">
                <h2 class="text-xl font-bold mb-4 border-l-4 border-cyan-400 pl-3">ğŸ” ä¸ªè‚¡è¯Šæ–­</h2>
                <div class="flex gap-2 mb-4">
                    <input type="text" id="stockInput" placeholder="è¾“å…¥ä»£ç  (å¦‚ 2330)" class="input-field flex-1 px-4 py-2 rounded-lg focus:outline-none focus:border-cyan-400">
                    <button onclick="analyzeStock()" class="btn-primary px-6 py-2 rounded-lg font-bold">åˆ†æ</button>
                </div>
                
                <div id="analysisResult" class="hidden space-y-4">
                    <div class="flex justify-between items-end border-b border-slate-700 pb-3">
                        <div>
                            <h3 id="stockNameDisplay" class="text-2xl font-bold text-white">--</h3>
                            <span class="text-xs bg-slate-700 px-2 py-1 rounded text-slate-300">äº¤æ˜“ä¸­</span>
                        </div>
                        <div class="text-right">
                            <div id="currentPrice" class="text-4xl font-bold text-white">--</div>
                            <div id="priceChange" class="text-base font-bold text-slate-400">--</div>
                        </div>
                    </div>

                    <div class="bg-slate-800/80 p-3 rounded-lg border border-yellow-600/30">
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-slate-400">ğŸ¯ ç³»ç»Ÿå»ºè®®ä¹°ç‚¹</span>
                            <span class="text-xs text-yellow-500 bg-yellow-900/20 px-2 rounded">æ”¯æ’‘ç®—æ³•</span>
                        </div>
                        <div class="flex justify-between items-end">
                            <span id="recommendBuy" class="text-2xl font-mono text-yellow-400 font-bold">--</span>
                            <span id="diffText" class="text-xs text-slate-400">è·ç°ä»· --%</span>
                        </div>
                    </div>

                    <div class="bg-slate-800 rounded-lg p-4 border border-slate-700">
                        <div class="flex justify-between mb-2">
                            <span class="text-cyan-400 font-bold">AI ç»¼åˆè¯„åˆ†</span>
                            <span id="aiScore" class="font-bold text-white text-xl">--</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-2 mb-3">
                            <div id="scoreBar" class="bg-cyan-500 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <div class="space-y-1 text-xs text-slate-400">
                            <div class="flex justify-between"><span>æŠ€æœ¯å‹æ€</span><span id="techStatus">--</span></div>
                        </div>
                    </div>

                    <button onclick="addToPortfolio()" class="w-full bg-cyan-700 hover:bg-cyan-600 text-white py-3 rounded-lg mt-2 transition shadow-lg">
                        + åŠ å…¥æŒä»“
                    </button>
                </div>
            </div>

            <!-- è§‚å¯Ÿæ¸…å• -->
            <div class="card p-5">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold border-l-4 border-yellow-400 pl-3">ğŸ“‹ è§‚å¯Ÿåå•</h2>
                    <button onclick="refreshWatchlist()" class="text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded text-slate-300">æ›´æ–°</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-slate-400 uppercase bg-slate-800">
                            <tr>
                                <th class="px-2 py-2">è‚¡å</th>
                                <th class="px-2 py-2 text-right">ç°ä»·</th>
                                <th class="px-2 py-2 text-right text-yellow-400">ä¹°ç‚¹</th>
                                <th class="px-2 py-2 text-right">ç©ºé—´</th>
                            </tr>
                        </thead>
                        <tbody id="watchlistBody" class="divide-y divide-slate-700"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼š499é›·è¾¾ & æŒä»“ -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- ğŸ”¥ æ ¸å¿ƒåŠŸèƒ½ï¼š499 å¤§æˆ·é›·è¾¾ -->
            <div class="card p-5 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-red-500/10 rounded-full blur-xl -mr-10 -mt-10 pointer-events-none"></div>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold border-l-4 border-red-500 pl-3 flex items-center">
                        ğŸ“¡ 499 å¤§æˆ·é›·è¾¾ 
                        <span class="ml-2 text-xs bg-red-900 text-red-300 px-2 py-0.5 rounded animate-pulse">LIVE ç›‘æ§ä¸­</span>
                    </h2>
                    <button onclick="scanBigOrders()" class="text-xs bg-red-900/50 hover:bg-red-900 text-white px-3 py-1 rounded border border-red-700">ğŸš€ ç«‹å³æ‰«æ</button>
                </div>
                
                <div class="overflow-x-auto max-h-64 bg-black/20 rounded-lg border border-slate-700/50">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-slate-400 uppercase bg-slate-800 sticky top-0 z-10">
                            <tr>
                                <th class="px-4 py-3">æ—¶é—´</th>
                                <th class="px-4 py-3">è‚¡ç¥¨</th>
                                <th class="px-4 py-3 text-right">å¤§å•æˆäº¤ (å¼ )</th>
                                <th class="px-4 py-3 text-right">æˆäº¤ä»·</th>
                                <th class="px-4 py-3 text-right">é‡‘é¢ (ä¸‡)</th>
                                <th class="px-4 py-3 text-center">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="bigOrderBody" class="divide-y divide-slate-700">
                            <tr><td colspan="6" class="text-center py-12 text-slate-500">ç­‰å¾… 499 å¤§å•è®¯å·å‡ºç°...</td></tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-xs text-slate-500 mt-2 text-right">* ç›‘æ§é€»è¾‘ï¼šä¾¦æµ‹å³æ—¶å•ç¬”æˆäº¤é‡ >= 499 å¼ </p>
            </div>

            <!-- æŒä»“ç®¡ç† -->
            <div class="card p-5">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold border-l-4 border-purple-400 pl-3">ğŸ’¼ æŒä»“æŸç›Š</h2>
                    <span id="totalProfit" class="text-2xl font-bold text-white">0</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-300">
                        <thead class="text-xs text-slate-400 uppercase bg-slate-800/80">
                            <tr>
                                <th class="px-4 py-3">è‚¡ç¥¨</th>
                                <th class="px-4 py-3 text-right">æˆæœ¬</th>
                                <th class="px-4 py-3 text-right">ç°ä»·</th>
                                <th class="px-4 py-3 text-right">åº“å­˜</th>
                                <th class="px-4 py-3 text-right">æŸç›Š</th>
                                <th class="px-4 py-3 text-center">åˆ é™¤</th>
                            </tr>
                        </thead>
                        <tbody id="portfolioBody" class="divide-y divide-slate-700"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”‘ API è®¾å®š
        const FUGLE_KEY = "OGNiYzc2YmQtMzdjYS00NTJkLWI1ZGUtNjY1ODRhNTMwNTAxIDhlMTRiMDVkLTk0NzItNDUzMi05NjY2LTkzYjlhMTQ5NzBjMw==";
        const FINMIND_TOKEN = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRlIjoiMjAyNS0xMS0yNyAxMjoyOToyOSIsInVzZXJfaWQiOiJMSU5QRyIsImlwIjoiMS4xNzAuMTE0LjIwIn0.SyyVMOX2eF6uNVO3EZpkRylFrQqFFXjH1PJcM5oFQt0";

        // ğŸ¯ ç›‘æ§æ±  (çƒ­é—¨è‚¡ + æƒå€¼è‚¡ï¼Œå› ä¸ºå¤§å•é€šå¸¸å‡ºç°åœ¨è¿™äº›è‚¡ç¥¨)
        const SCAN_POOL = ['2330','2317','2454','2603','2609','2615','2881','2308','3037','2382','3231','6669','2303','2882','1513','1519','2356','2376'];
        const WATCH_LIST_IDS = ['2330', '2317', '2454', '2603', '2881'];
        
        let currentStock = null;
        let portfolio = JSON.parse(localStorage.getItem('pro_portfolio_v3')) || [];

        window.onload = () => {
            renderPortfolio();
            refreshWatchlist();
            setInterval(updatePortfolioPrices, 60000);
            
            // è‡ªåŠ¨å¯åŠ¨å¤§å•æ‰«æ (æ¨¡æ‹Ÿç›˜ä¸­æ¯ 10 ç§’æ‰«ä¸€æ¬¡)
            // æ³¨æ„ï¼šçœŸå® Fugle å…è´¹ç‰ˆæœ‰æ¯åˆ†é’Ÿ 60 æ¬¡é™åˆ¶ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ§åˆ¶é¢‘ç‡
            setInterval(scanBigOrders, 15000); 
        };

        // ğŸ”¥ æ ¸å¿ƒåŠŸèƒ½ï¼š499 å¤§å•æ‰«æ
        async function scanBigOrders() {
            const tbody = document.getElementById('bigOrderBody');
            
            // å¦‚æœè¿˜æ˜¯åˆå§‹çŠ¶æ€ï¼Œæ¸…ç©º
            if(tbody.innerHTML.includes('ç­‰å¾…')) tbody.innerHTML = '';
            
            // éšæœºå– 3 æ¡£è‚¡ç¥¨æ¥æ£€æŸ¥ (é¿å…ä¸€æ¬¡ request å¤ªå¤šè¢«é” IP)
            const randomTargets = SCAN_POOL.sort(() => 0.5 - Math.random()).slice(0, 3);

            for (const id of randomTargets) {
